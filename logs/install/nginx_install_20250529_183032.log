
================================================================================
DÉMARRAGE: nginx_install
Description: Installation Nginx et Dashboard
Date: Thu 29 May 18:30:32 CEST 2025
Utilisateur: root
Répertoire: /media/prod/MAXLINK
================================================================================

[2025-05-29 18:30:32] [INFO] [nginx_install] Script nginx_install initialisé
[2025-05-29 18:30:32] [INFO] [nginx_install] ========== DÉBUT DE L'INSTALLATION NGINX ET DASHBOARD ==========
[2025-05-29 18:30:32] [INFO] [nginx_install] Progression: 5% - Préparation du système...
[2025-05-29 18:30:32] [INFO] [nginx_install] Privilèges root confirmés
[2025-05-29 18:30:32] [INFO] [nginx_install] Stabilisation du système - attente 5s
[2025-05-29 18:30:37] [INFO] [nginx_install] Mode AP actif détecté - désactivation temporaire
[2025-05-29 18:30:37] [CMD] [nginx_install] Exécution: Désactivation AP
[2025-05-29 18:30:38] [CMD] [nginx_install] Commande: nmcli con down 'MaxLink-NETWORK' >/dev/null 2>&1
[2025-05-29 18:30:38] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:30:40] [INFO] [nginx_install] Interface WiFi wlan0 détectée
[2025-05-29 18:30:40] [CMD] [nginx_install] Exécution: Activation WiFi
[2025-05-29 18:30:41] [CMD] [nginx_install] Commande: nmcli radio wifi on >/dev/null 2>&1
[2025-05-29 18:30:41] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:30:43] [INFO] [nginx_install] Progression: 10% - WiFi préparé
[2025-05-29 18:30:45] [INFO] [nginx_install] Progression: 15% - Recherche du réseau...
[2025-05-29 18:30:45] [CMD] [nginx_install] Exécution: Scan WiFi
[2025-05-29 18:30:45] [CMD] [nginx_install] Commande: nmcli device wifi rescan >/dev/null 2>&1
[2025-05-29 18:30:45] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:30:50] [INFO] [nginx_install] Réseau Max trouvé - Signal: 11 dBm
[2025-05-29 18:30:50] [INFO] [nginx_install] Progression: 20% - Connexion en cours...
[2025-05-29 18:30:51] [CMD] [nginx_install] Exécution: Suppression ancienne connexion
[2025-05-29 18:30:51] [CMD] [nginx_install] Commande: nmcli connection delete 'Max' 2>/dev/null || true
[2025-05-29 18:30:51] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:30:51] [CMD] [nginx_install] Exécution: Connexion WiFi
[2025-05-29 18:30:51] [CMD] [nginx_install] Commande: nmcli device wifi connect 'Max' password '1234567890' >/dev/null 2>&1
[2025-05-29 18:30:51] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:30:51] [INFO] [nginx_install] Connexion WiFi initiée - attente IP
[2025-05-29 18:30:57] [SUCCESS] [nginx_install] Connexion établie - IP: 192.168.241.61
[2025-05-29 18:30:59] [CMD] [nginx_install] Exécution: Test ping Google DNS
[2025-05-29 18:30:59] [CMD] [nginx_install] Commande: ping -c 3 -W 2 8.8.8.8 >/dev/null 2>&1
[2025-05-29 18:31:01] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:01] [CMD] [nginx_install] Exécution: Test résolution DNS
[2025-05-29 18:31:01] [CMD] [nginx_install] Commande: ping -c 3 -W 2 google.com >/dev/null 2>&1
[2025-05-29 18:31:03] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:04] [SUCCESS] [nginx_install] Connectivité internet complète
[2025-05-29 18:31:04] [INFO] [nginx_install] Progression: 30% - Connexion établie
[2025-05-29 18:31:06] [INFO] [nginx_install] Progression: 35% - Installation de Nginx...
[2025-05-29 18:31:06] [INFO] [nginx_install] Installation de Nginx nécessaire
[2025-05-29 18:31:06] [CMD] [nginx_install] Exécution: Mise à jour des dépôts
[2025-05-29 18:31:06] [CMD] [nginx_install] Commande: apt-get update -qq
[2025-05-29 18:31:08] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:08] [CMD] [nginx_install] Exécution: Installation Nginx
[2025-05-29 18:31:08] [CMD] [nginx_install] Commande: apt-get install -y nginx >/dev/null 2>&1
[2025-05-29 18:31:14] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:14] [SUCCESS] [nginx_install] Nginx installé avec succès
[2025-05-29 18:31:14] [CMD] [nginx_install] Exécution: Arrêt Nginx
[2025-05-29 18:31:14] [CMD] [nginx_install] Commande: systemctl stop nginx >/dev/null 2>&1
[2025-05-29 18:31:14] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:14] [INFO] [nginx_install] Progression: 45% - Nginx installé
[2025-05-29 18:31:16] [INFO] [nginx_install] Progression: 50% - Téléchargement du dashboard...
[2025-05-29 18:31:16] [INFO] [nginx_install] Git déjà disponible
[2025-05-29 18:31:17] [INFO] [nginx_install] Répertoire temporaire: /tmp/maxlink-dashboard-1748536277
[2025-05-29 18:31:17] [INFO] [nginx_install] Clonage depuis: https://github.com/B4ckZ/MaxLinK.git (branch: main)
[2025-05-29 18:31:17] [CMD] [nginx_install] Exécution: Clonage GitHub
[2025-05-29 18:31:17] [CMD] [nginx_install] Commande: git clone --branch 'main' --depth 1 'https://github.com/B4ckZ/MaxLinK.git' '/tmp/maxlink-dashboard-1748536277/repo' >/dev/null 2>&1
[2025-05-29 18:31:18] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:18] [SUCCESS] [nginx_install] Dépôt cloné avec succès
[2025-05-29 18:31:18] [CMD] [nginx_install] Exécution: Copie dashboard
[2025-05-29 18:31:19] [CMD] [nginx_install] Commande: cp -r '/tmp/maxlink-dashboard-1748536277/repo/DashBoardV1' '/var/www/maxlink-dashboard'
[2025-05-29 18:31:19] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:19] [SUCCESS] [nginx_install] Dashboard copié avec succès
[2025-05-29 18:31:19] [INFO] [nginx_install] Nettoyage du répertoire temporaire
[2025-05-29 18:31:19] [CMD] [nginx_install] Exécution: Application permissions
[2025-05-29 18:31:19] [CMD] [nginx_install] Commande: chown -R www-data:www-data '/var/www/maxlink-dashboard'
[2025-05-29 18:31:19] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:19] [CMD] [nginx_install] Exécution: Application droits
[2025-05-29 18:31:19] [CMD] [nginx_install] Commande: chmod -R 755 '/var/www/maxlink-dashboard'
[2025-05-29 18:31:20] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:20] [INFO] [nginx_install] Progression: 65% - Dashboard installé
[2025-05-29 18:31:21] [INFO] [nginx_install] Progression: 75% - Configuration de Nginx...
[2025-05-29 18:31:21] [INFO] [nginx_install] Création de la configuration Nginx
[2025-05-29 18:31:21] [SUCCESS] [nginx_install] Configuration Nginx créée
[2025-05-29 18:31:22] [CMD] [nginx_install] Exécution: Vérification propriétaire
[2025-05-29 18:31:22] [CMD] [nginx_install] Commande: chown -R www-data:www-data '/var/www/maxlink-dashboard'
[2025-05-29 18:31:22] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:22] [CMD] [nginx_install] Exécution: Permissions dossiers
[2025-05-29 18:31:22] [CMD] [nginx_install] Commande: find '/var/www/maxlink-dashboard' -type d -exec chmod 755 {} \;
[2025-05-29 18:31:22] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:22] [CMD] [nginx_install] Exécution: Permissions fichiers
[2025-05-29 18:31:22] [CMD] [nginx_install] Commande: find '/var/www/maxlink-dashboard' -type f -exec chmod 644 {} \;
[2025-05-29 18:31:22] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:23] [CMD] [nginx_install] Exécution: Suppression site par défaut
[2025-05-29 18:31:23] [CMD] [nginx_install] Commande: rm -f /etc/nginx/sites-enabled/default 2>/dev/null || true
[2025-05-29 18:31:23] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:23] [CMD] [nginx_install] Exécution: Suppression ancien lien
[2025-05-29 18:31:23] [CMD] [nginx_install] Commande: rm -f /etc/nginx/sites-enabled/maxlink-dashboard 2>/dev/null || true
[2025-05-29 18:31:23] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:23] [CMD] [nginx_install] Exécution: Création lien symbolique
[2025-05-29 18:31:23] [CMD] [nginx_install] Commande: ln -s /etc/nginx/sites-available/maxlink-dashboard /etc/nginx/sites-enabled/
[2025-05-29 18:31:23] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:23] [INFO] [nginx_install] Site Nginx activé
[2025-05-29 18:31:24] [CMD] [nginx_install] Exécution: Test configuration Nginx
[2025-05-29 18:31:24] [CMD] [nginx_install] Commande: nginx -t >/dev/null 2>&1
[2025-05-29 18:31:24] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:24] [SUCCESS] [nginx_install] Configuration Nginx valide
[2025-05-29 18:31:24] [CMD] [nginx_install] Exécution: Activation au démarrage
[2025-05-29 18:31:24] [CMD] [nginx_install] Commande: systemctl enable nginx >/dev/null 2>&1
[2025-05-29 18:31:25] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:25] [CMD] [nginx_install] Exécution: Démarrage Nginx
[2025-05-29 18:31:25] [CMD] [nginx_install] Commande: systemctl start nginx >/dev/null 2>&1
[2025-05-29 18:31:25] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:25] [SUCCESS] [nginx_install] Nginx démarré avec succès
[2025-05-29 18:31:27] [SUCCESS] [nginx_install] Autoindex fonctionnel
[2025-05-29 18:31:28] [INFO] [nginx_install] Progression: 85% - Nginx configuré
[2025-05-29 18:31:30] [INFO] [nginx_install] Progression: 90% - Configuration DNS...
[2025-05-29 18:31:30] [INFO] [nginx_install] Vérification de la configuration AP existante
[2025-05-29 18:31:30] [INFO] [nginx_install] Mode AP détecté, mise à jour DNS nécessaire
[2025-05-29 18:31:30] [INFO] [nginx_install] Configuration DNS déjà présente
[2025-05-29 18:31:30] [INFO] [nginx_install] Progression: 95% - Configuration terminée
[2025-05-29 18:31:32] [INFO] [nginx_install] Progression: 98% - Finalisation...
[2025-05-29 18:31:32] [CMD] [nginx_install] Exécution: Déconnexion WiFi
[2025-05-29 18:31:32] [CMD] [nginx_install] Commande: nmcli connection down 'Max' >/dev/null 2>&1
[2025-05-29 18:31:33] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:35] [CMD] [nginx_install] Exécution: Suppression profil WiFi
[2025-05-29 18:31:35] [CMD] [nginx_install] Commande: nmcli connection delete 'Max' >/dev/null 2>&1
[2025-05-29 18:31:35] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:35] [INFO] [nginx_install] WiFi déconnecté
[2025-05-29 18:31:35] [INFO] [nginx_install] Réactivation du mode AP
[2025-05-29 18:31:35] [CMD] [nginx_install] Exécution: Activation AP
[2025-05-29 18:31:35] [CMD] [nginx_install] Commande: nmcli con up 'MaxLink-NETWORK' >/dev/null 2>&1 || true
[2025-05-29 18:31:36] [CMD] [nginx_install] Code de sortie: 0
[2025-05-29 18:31:39] [INFO] [nginx_install] Progression: 100% - Installation terminée !
[2025-05-29 18:31:39] [INFO] [nginx_install] Installation terminée avec succès
[2025-05-29 18:31:39] [INFO] [nginx_install] Dashboard accessible à: http://192.168.4.1 et http://maxlink-dashboard.local
[2025-05-29 18:31:39] [INFO] [nginx_install] Redémarrage du système prévu dans 10 secondes
[2025-05-29 18:31:49] [INFO] [nginx_install] Redémarrage du système
[2025-05-29 18:31:49] [INFO] [nginx_install] Script nginx_install terminé avec le code 0
